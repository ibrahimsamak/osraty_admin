{"remainingRequest":"/Users/ibrahimm.samak/Desktop/liken/CPanel-API/admin/node_modules/@angular-devkit/build-optimizer/src/build-optimizer/webpack-loader.js??ref--8-1!/Users/ibrahimm.samak/Desktop/liken/CPanel-API/admin/node_modules/ng2-smart-table/lib/data-source/server/server.data-source.js","dependencies":[{"path":"/Users/ibrahimm.samak/Desktop/liken/CPanel-API/admin/node_modules/ng2-smart-table/lib/data-source/server/server.data-source.js","mtime":499162500000},{"path":"/Users/ibrahimm.samak/Desktop/liken/CPanel-API/admin/node_modules/cache-loader/dist/cjs.js","mtime":1541238936889},{"path":"/Users/ibrahimm.samak/Desktop/liken/CPanel-API/admin/node_modules/@angular-devkit/build-optimizer/src/build-optimizer/webpack-loader.js","mtime":1525376550000}],"contextDependencies":[],"result":["import { __extends } from \"tslib\";\nimport { HttpParams } from '@angular/common/http';\nimport { LocalDataSource } from '../local/local.data-source';\nimport { ServerSourceConf } from './server-source.conf';\nimport { getDeepFromObject } from '../../helpers';\nimport { map } from 'rxjs/operators';\nvar ServerDataSource = /*@__PURE__*/ (function (_super) {\n    __extends(ServerDataSource, _super);\n    function ServerDataSource(http, conf) {\n        if (conf === void 0) {\n            conf = {};\n        }\n        var _this = _super.call(this) || this;\n        _this.http = http;\n        _this.lastRequestCount = 0;\n        _this.conf = new ServerSourceConf(conf);\n        if (!_this.conf.endPoint) {\n            throw new Error('At least endPoint must be specified as a configuration of the server data source.');\n        }\n        return _this;\n    }\n    ServerDataSource.prototype.count = function () {\n        return this.lastRequestCount;\n    };\n    ServerDataSource.prototype.getElements = function () {\n        var _this = this;\n        return this.requestElements()\n            .pipe(map(function (res) {\n            _this.lastRequestCount = _this.extractTotalFromResponse(res);\n            _this.data = _this.extractDataFromResponse(res);\n            return _this.data;\n        })).toPromise();\n    };\n    /**\n     * Extracts array of data from server response\n     * @param res\n     * @returns {any}\n     */\n    /**\n       * Extracts array of data from server response\n       * @param res\n       * @returns {any}\n       */\n    ServerDataSource.prototype.extractDataFromResponse = /**\n       * Extracts array of data from server response\n       * @param res\n       * @returns {any}\n       */\n        function (res) {\n            var rawData = res.body;\n            var data = !!this.conf.dataKey ? getDeepFromObject(rawData, this.conf.dataKey, []) : rawData;\n            if (data instanceof Array) {\n                return data;\n            }\n            throw new Error(\"Data must be an array.\\n    Please check that data extracted from the server response by the key '\" + this.conf.dataKey + \"' exists and is array.\");\n        };\n    /**\n     * Extracts total rows count from the server response\n     * Looks for the count in the heders first, then in the response body\n     * @param res\n     * @returns {any}\n     */\n    /**\n       * Extracts total rows count from the server response\n       * Looks for the count in the heders first, then in the response body\n       * @param res\n       * @returns {any}\n       */\n    ServerDataSource.prototype.extractTotalFromResponse = /**\n       * Extracts total rows count from the server response\n       * Looks for the count in the heders first, then in the response body\n       * @param res\n       * @returns {any}\n       */\n        function (res) {\n            if (res.headers.has(this.conf.totalKey)) {\n                return +res.headers.get(this.conf.totalKey);\n            }\n            else {\n                var rawData = res.body;\n                return getDeepFromObject(rawData, this.conf.totalKey, 0);\n            }\n        };\n    ServerDataSource.prototype.requestElements = function () {\n        var httpParams = this.createRequesParams();\n        return this.http.get(this.conf.endPoint, { params: httpParams, observe: 'response' });\n    };\n    ServerDataSource.prototype.createRequesParams = function () {\n        var httpParams = new HttpParams();\n        httpParams = this.addSortRequestParams(httpParams);\n        httpParams = this.addFilterRequestParams(httpParams);\n        return this.addPagerRequestParams(httpParams);\n    };\n    ServerDataSource.prototype.addSortRequestParams = function (httpParams) {\n        var _this = this;\n        if (this.sortConf) {\n            this.sortConf.forEach(function (fieldConf) {\n                httpParams = httpParams.set(_this.conf.sortFieldKey, fieldConf.field);\n                httpParams = httpParams.set(_this.conf.sortDirKey, fieldConf.direction.toUpperCase());\n            });\n        }\n        return httpParams;\n    };\n    ServerDataSource.prototype.addFilterRequestParams = function (httpParams) {\n        var _this = this;\n        if (this.filterConf.filters) {\n            this.filterConf.filters.forEach(function (fieldConf) {\n                if (fieldConf['search']) {\n                    httpParams = httpParams.set(_this.conf.filterFieldKey.replace('#field#', fieldConf['field']), fieldConf['search']);\n                }\n            });\n        }\n        return httpParams;\n    };\n    ServerDataSource.prototype.addPagerRequestParams = function (httpParams) {\n        if (this.pagingConf && this.pagingConf['page'] && this.pagingConf['perPage']) {\n            httpParams = httpParams.set(this.conf.pagerPageKey, this.pagingConf['page']);\n            httpParams = httpParams.set(this.conf.pagerLimitKey, this.pagingConf['perPage']);\n        }\n        return httpParams;\n    };\n    return ServerDataSource;\n}(LocalDataSource));\nexport { ServerDataSource };\n//# sourceMappingURL=server.data-source.js.map\n",null]}